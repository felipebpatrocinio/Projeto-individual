<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script src="./js/sessao.js"></script>
    <link rel="stylesheet" href="css/styles/navbar_footer.css">
    <link rel="stylesheet" href="css/styles/cadastro.css">
</head>

<body>
    <header>
        <img class="logotipo" src="assets/Logotipo.png">
        <nav>
            <ul class="navbar-links">
                <li><a href="index.html">Início</a></li>
                <li><a href="index.html#sobre_mim">Sobre mim</a></li>
                <li><a href="index.html#footer">Contato</a></li>
                <li><a href="cadastro.html">Cadastro</a></li>
            </ul>
        </nav>
        <a href="login.html"><button>Entrar</button></a>
    </header>

    <main>
        <div class="container_cadastro">
            <h1>Seja bem vindo(a)!</h1>

            <div class="cadastro_formulario" id="cadastro_formulario">
                <input type="text" placeholder="Nome" id="input_nome">
                <input type="text" placeholder="Sobrenome" id="input_sobrenome"> <br>
                <input type="text" placeholder="Email" id="input_email">
                <select name="Nível de habilidade" id="select_nivel">
                    <option selected disabled value="#">Nível de habilidade</option>
                    <option value="Iniciante">Iniciante</option>
                    <option value="Intermediário">Intermediário</option>
                    <option value="Avançado">Avançado</option>
                </select> <br>
                <input type="text" placeholder="Senha" id="input_senha">
                <input type="text" placeholder="Confirme sua senha" id="input_confirmeSenha">
                <div class="erro_validacao">
                    <div style="opacity: 0;" class="erro_senha" id="div_erro_senha">A senha deve conter no mínimo 8
                        caracteres.</div>
                    <div style="opacity: 0;" class="erro_confirmacao" id="div_erro_confirmacao">As senhas devem ser
                        iguais! </div>
                </div>
            </div>
            <div class="erro_campo" id="div_erro_campo">Preencha todos os campos!</div>
            <button onclick="cadastrar()"><b>Criar conta</b></button>
            <li>Já possui conta? <a href="login.html"><b>Entrar</b></a></li>
        </div>
    </main>
</body>

</html>

<script>
    listaNumeros = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];

    function cadastrar() {
        var nome = input_nome.value;
        var sobrenome = input_sobrenome.value;
        var email = input_email.value;
        var nivel = select_nivel.value;
        var senha = input_senha.value;
        var confirmacaoSenha = input_confirmeSenha.value;
        var bordaPreta = "1px solid black";
        var bordaVermelha = "1px solid red";

        /* Validação de campos vazios */
        if (nome == "" || sobrenome == "" || email == "" || nivel == "#" || senha == "" || confirmacaoSenha == "") {
            div_erro_campo.style.opacity = "1";

            if (nome == "") {
                input_nome.style.border = bordaVermelha;
            } else {
                input_nome.style.border = bordaPreta;
            }

            if (sobrenome == "") {
                input_sobrenome.style.border = bordaVermelha;
            } else {
                input_sobrenome.style.border = bordaPreta;
            }

            if (email == "") {
                input_email.style.border = bordaVermelha;
            } else {
                input_email.style.border = bordaPreta;
            }

            if (nivel == "#") {
                select_nivel.style.border = bordaVermelha;
            } else {
                select_nivel.style.border = bordaPreta;
            }

            if (senha == "") {
                input_senha.style.border = bordaVermelha;
            } else {
                input_senha.style.border = bordaPreta;
            }

            if (confirmacaoSenha == "") {
                input_confirmeSenha.style.border = bordaVermelha;
            } else {
                input_confirmeSenha.style.border = bordaPreta;
            }
        } else {
            input_nome.style.border = bordaPreta;
            input_sobrenome.style.border = bordaPreta;
            input_email.style.border = bordaPreta;
            select_nivel.style.border = bordaPreta;
            input_senha.style.border = bordaPreta;
            input_confirmeSenha.style.border = bordaPreta;
            div_erro_campo.style.opacity = "0";

            var emailValido = (email.endsWith('.com') || email.endsWith('.school')) && email.includes("@") && (email.toLowerCase() == email);

            /* Validação do campo email */
            if (emailValido == false) {
                div_erro_campo.style.opacity = "1";
                div_erro_campo.innerHTML = "Email inválido, tente novamente!";
                input_email.style.border = bordaVermelha;
            } else if (senha.length < 8) {      /* Validação do campo senha */
                div_erro_campo.style.opacity = "0";
                input_email.style.border = bordaPreta;
                input_senha.style.border = bordaVermelha;
                div_erro_senha.style.opacity = "1";
            } else if (confirmacaoSenha != senha) { /* Validação do campo confirmação de senha */
                input_senha.style.border = bordaPreta;
                input_confirmeSenha.style.border = bordaVermelha;
                div_erro_senha.style.opacity = "0";
                div_erro_confirmacao.style.opacity = "1";
            } else { /* Cenário correto */
                div_erro_confirmacao.style.opacity = "0";
                input_confirmeSenha.style.border = bordaPreta;

                /* Aqui vou deixar os códigos da web-data-viz para cadastrar usuário */

                fetch("/usuarios/cadastrar", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        // crie um atributo que recebe o valor recuperado aqui
                        // Agora vá para o arquivo routes/usuario.js
                        nomeServer: nome,
                        sobrenomeServer: sobrenome,
                        emailServer: email,
                        nivelServer: nivel,
                        senhaServer: senha
                    }),
                })

                    .then(function (resposta) {
                        console.log("resposta: ", resposta);

                        if (resposta.ok) {

                            div_erro_campo.style.opacity = "1";
                            div_erro_campo.innerHTML =
                                "Seu cadastro foi feito com sucesso!";

                        } else {

                            throw "Houve um erro ao tentar realizar o cadastro!";
                        }
                    })
                    .catch(function (resposta) {
                        console.log(`#ERRO: ${resposta}`);
                    });

                return false;

                alert('Seu cadastro foi feito com sucesso!');
                window.location.href = "login.html";
    
            }
        }
    }
</script>