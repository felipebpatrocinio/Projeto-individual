<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/telaUsuario.css">
</head>

<body onload="carregarPagina()">
    <!--Side Bar-->
    <aside class="sidebar">
        <header class="sidebar_header">
            <p id="mensagem_usuario">Olá, user!</p>
        </header>

        <nav class="sidebar_botoes">
            <button onclick="irParaDashboard()">
                <span>
                    <img src="assets/grafico.svg" alt="">
                    <span>Dashboard</span>
                </span>
            </button>

            <button onclick="irParaEstudo()">
                <span>
                    <img src="assets/estudo.svg" alt="">
                    <span>Novo estudo</span>
                </span>
            </button>

            <button onclick="irParaMeta()">
                <span>
                    <img src="assets/meta.svg" alt="">
                    <span>Metas</span>
                </span>
            </button>

            <button onclick="irParaConfiguracao()">
                <span>
                    <img src="assets/configuracao.svg" alt="">
                    <span>Configurações</span>
                </span>
            </button>

            <button style="margin-bottom: 0;" onclick="sair()">
                <span>
                    <img src="assets/sair.svg" alt="">
                    <span>Sair</span>
                </span>
            </button>
        </nav>
        <img class="logotipo" src="assets/Logotipo.png" alt="">
    </aside>
    <!--Fim Side Bar-->

    <!--Dashboard-->
    <section class="dashboard" id="dashboard">
        <div class="kpis">
            <div class="kpi1">
                Dias totais estudados

            </div>

            <div class="kpi2">
                OI

            </div>

            <div class="kpi3">
                OI

            </div>

            <div class="kpi4">
                OI

            </div>
        </div>
        <div class="graficos">
            <div class="grafico1">OI</div>
            <div class="grafico2">OI</div>
        </div>
    </section>

    <!--Fim Dashboard-->

    <!--Estudo-->
    <section class="estudo" id="estudo">
        <div class="container_estudo">
            <h1>Insira um novo estudo</h1>
            <label class="dtEstudo">
                Data do estudo
                <input type="date" id="input_dtEstudo" placeholder="Data do estudo">
            </label>
            <label class="tempoEstudo">
                Tempo estudado (em minutos)
                <input type="number" id="input_tempo" placeholder="Insira o tempo">
            </label>
            <label class="dificuldade">
                Maior dificuldade
                <select name="" id="select_dificuldade">
                    <option selected disabled value="#">Selecione uma opção</option>
                    <option value="Arcada">Arcada</option>
                    <option value="Vibrato">Vibrato</option>
                    <option value="Postura">Postura</option>
                    <option value="Dedilhado">Dedilhado</option>
                </select>
            </label>
            <div id="div_erroCampo" class="erroCampo">Preencha todos os campos!</div>
            <button onclick="registrarEstudo()"><b>Registrar estudo</b></button>
        </div>
        <span>Lorem ipsum dolor sit amet consectetur adipisicing elit. Sunt, provident!</span>
    </section>
    <!--Fim Estudo-->

    <!--Metas-->
    <section class="meta" id="meta">
        <div class="container_historico">
            <h1>Minhas metas</h1>
            <div class="tabela"></div>
        </div>
        <div class="nova_meta">
            <h1>Nova meta</h1>
            <div class="formulario_novaMeta">
                <label>
                    Prazo de início
                    <input type="date" id="input_dtInicio">
                </label>
                <label>
                    Prazo final
                    <input type="date" id="input_dtFinal">
                </label>
                <label>
                    Dias de estudo
                    <input type="text" id="input_totalDia">
                </label>
            </div>

            <button onclick="registrarMeta()"><b>Registrar meta</b></button>
            <span class="metaRegistrada" id="metaRegistrada">Meta registrada!</span>
            <span class="erroMeta" id="erroMeta">Preencha todos os campos!</span>
        </div>
    </section>
    <!--Fim Metas-->

    <!--Configurações-->
    <section class="configuracao" id="configuracao">
        <div class="topo">
            <h1>Perfil</h1>
            <img src="assets/Logotipo_footer.png">
        </div>

        <label>
            <b>Nome</b>
            <input type="text" id="input_nomeConfig">
        </label>
        <label>
            <b>Sobrenome</b>
            <input type="text" id="input_sobrenomeConfig">
        </label>
        <label>
            <b>Nível</b>
            <select id="select_nivelConfig">
                <option value="Iniciante">Iniciante</option>
                <option value="Intermediário">Intermediário</option>
                <option value="Avançado">Avançado</option>
            </select>
        </label>
        <button><b>Salvar alterações</b></button>

    </section>
    <!--Fim Configurações-->
</body>

</html>

<script>
    function carregarPagina() {
        window.location.href = '#dashboard';
        var nome = sessionStorage.NOME_USUARIO;
        mensagem_usuario.innerHTML = `Olá, ${nome}!`;
    }
    function irParaDashboard() {
        dashboard.style.display = 'flex';
        estudo.style.display = 'none';
        meta.style.display = 'none';
        configuracao.style.display = 'none';
    }

    function irParaEstudo() {
        dashboard.style.display = 'none';
        estudo.style.display = 'flex';
        meta.style.display = 'none';
        configuracao.style.display = 'none';
    }

    function irParaMeta() {
        dashboard.style.display = 'none';
        estudo.style.display = 'none';
        meta.style.display = 'flex';
        configuracao.style.display = 'none';
    }

    function irParaConfiguracao() {
        dashboard.style.display = 'none';
        estudo.style.display = 'none';
        meta.style.display = 'none';
        configuracao.style.display = 'flex';

        var nomeConfig = sessionStorage.NOME_USUARIO;

        input_nomeConfig.value = `${nomeConfig}`;
    }

    function sair() {
        window.location.href = "login.html";
    }

    function registrarEstudo() {
        var dtEstudo = input_dtEstudo.value;
        var tempoEstudo = Number(input_tempo.value);
        var dificuldade = select_dificuldade.value;
        var fkUsuario = sessionStorage.ID_USUARIO;

        if (dtEstudo == "" || tempoEstudo == 0 || dificuldade == "#") {
            div_erroCampo.style.opacity = "1";
        } else {
            fetch("/estudo/registrarEstudo", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    dtEstudoServer: dtEstudo,
                    tempoEstudoServer: tempoEstudo,
                    dificuldadeServer: dificuldade,
                    fkUsuarioServer: fkUsuario

                })
            }).then(function (resposta) {
                console.log(resposta)

                if (resposta.ok) {
                    console.log(resposta);

                } else {

                    console.log("Erro ao tentar registrar o estudo");

                    resposta.text().then(texto => {
                        console.error(texto);
                    });
                }

            }).catch(function (erro) {
                console.log(erro);
            })
        }
    }

    function registrarMeta() {
        var dtInicio = input_dtInicio.value;
        var dtFinal = input_dtFinal.value;
        var totalDia = input_totalDia.value;
        var fkUsuario = sessionStorage.ID_USUARIO;

        if (dtInicio == "" || dtFinal == "" || totalDia == 0) {
            erroMeta.style.display = "flex";
        } else {
            erroMeta.style.display = "none";

            fetch("/meta/registrarMeta", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    dtInicioServer: dtInicio,
                    dtFinalServer: dtFinal,
                    totalDiaServer: totalDia,
                    fkUsuarioServer: fkUsuario
                })
            }).then(function (resposta) {
                console.log(resposta)

                if (resposta.ok) {
                    console.log(resposta);

                    metaRegistrada.style.opacity = '1';


                } else {

                    console.log("Erro ao tentar registrar a meta");

                    metaRegistrada.style.opacity = '1';

                    setTimeout(() => {
                        metaRegistrada.style.opacity = '0';
                    }, 2000);
                    

                    resposta.text().then(texto => {
                        console.error(texto);
                    });
                }

            }).catch(function (erro) {
                console.log(erro);
            })
        }
    }
</script>